(function(e,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("@nocobase/client"),require("react/jsx-runtime"),require("@ant-design/icons"),require("@nocobase/plugin-workflow/client"),require("react"),require("@formily/react"),require("antd"),require("react-i18next")):typeof define=="function"&&define.amd?define(["exports","@nocobase/client","react/jsx-runtime","@ant-design/icons","@nocobase/plugin-workflow/client","react","@formily/react","antd","react-i18next"],o):(e=typeof globalThis!="undefined"?globalThis:e||self,o(e["@ashley/plugin-workflow-jump"]={},e["@nocobase/client"],e.jsxRuntime,e["@ant-design/icons"],e["@nocobase/plugin-workflow"],e.react,e["@formily/react"],e.antd))})(this,function(e,o,t,y,r,l,f,i){"use strict";var I=Object.defineProperty;var J=(e,o,t)=>o in e?I(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var s=(e,o,t)=>(J(e,typeof o!="symbol"?o+"":o,t),t);var w=(e,o,t)=>new Promise((y,r)=>{var l=n=>{try{i(t.next(n))}catch(c){r(c)}},f=n=>{try{i(t.throw(n))}catch(c){r(c)}},i=n=>n.done?y(n.value):Promise.resolve(n.value).then(l,f);i((t=t.apply(e,o)).next())});const n=["yes","no","branch"],c=a=>{if(!a)return;const u=a.match(/{{\$jobsMapByNodeKey\.(\w+)}}/);return u?u[1]:`{{$jobsMapByNodeKey.${a}}}`},N=f.connect(a=>{const{data:u}=a,d=f.useField(),{nodes:q}=r.useFlowContext(),[b,S]=l.useState(!1),[p,v]=l.useState(null),[C,P]=l.useState(""),T=r.getUpstreamNodes(u),j=h=>{P(h)},E=()=>t.jsx("div",{children:t.jsx(r.WorkflowNodeTree,{nodes:T,searchValue:C,disabledNodes:n,selectedKeys:[c(d.value)],onSelect:(h,{node:m})=>{d.setValue(c(m.key)),S(!1),v(m)},onFocus:()=>{S(!0)},onSearch:j,enableSearch:!1})});return l.useEffect(()=>{const h=q.find(({key:m})=>c(m)===d.value);v(h)},[]),t.jsx("div",{children:t.jsx(i.Select,{value:d.value,open:b,onDropdownVisibleChange:S,showSearch:!0,dropdownRender:E,dropdownStyle:{maxWidth:"600px",maxHeight:"600px",overflow:"auto"},style:{maxWidth:"600px"},onSearch:j,children:t.jsx(i.Select.Option,{value:d.value,children:t.jsxs("div",{style:{marginLeft:4},children:[t.jsx(i.Tag,{children:p==null?void 0:p.type}),(p==null?void 0:p.title)||d.value]})})})})}),x="@ashley/plugin-workflow-jump";class k extends r.Instruction{constructor(){super(...arguments);s(this,"title",`{{t("Jump", { ns: "${x}" })}}`);s(this,"type","jump");s(this,"group","control");s(this,"description",`{{t("Jump to another node", { ns: "${x}" })}}`);s(this,"icon",t.jsx(y.PullRequestOutlined,{}));s(this,"fieldset",{targetNode:{type:"string",required:!0,title:`{{t("Target Node", { ns: "${x}" })}}`,"x-decorator":"FormItem","x-component":"NodeSelect","x-component-props":{data:"{{ data }}"}}});s(this,"components",{NodeSelect:N})}}class g extends o.Plugin{afterAdd(){return w(this,null,function*(){})}beforeLoad(){return w(this,null,function*(){})}load(){return w(this,null,function*(){this.app.pm.get("workflow").registerInstruction("jump",k)})}}e.PluginWorkflowJumpClient=g,e.default=g,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
