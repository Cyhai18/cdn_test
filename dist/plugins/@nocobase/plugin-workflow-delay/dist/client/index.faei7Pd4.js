(function(e,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("@nocobase/client"),require("react/jsx-runtime"),require("@ant-design/icons"),require("antd"),require("@nocobase/plugin-workflow/client"),require("react-i18next")):typeof define=="function"&&define.amd?define(["exports","@nocobase/client","react/jsx-runtime","@ant-design/icons","antd","@nocobase/plugin-workflow/client","react-i18next"],t):(e=typeof globalThis!="undefined"?globalThis:e||self,t(e["@nocobase/plugin-workflow-delay"]={},e["@nocobase/client"],e.jsxRuntime,e["@ant-design/icons"],e.antd,e["@nocobase/plugin-workflow"]))})(this,function(e,t,n,m,d,r){"use strict";var h=Object.defineProperty;var S=(e,t,n)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var s=(e,t,n)=>(S(e,typeof t!="symbol"?t+"":t,n),n);var w=(e,t,n)=>new Promise((m,d)=>{var r=o=>{try{l(n.next(o))}catch(p){d(p)}},a=o=>{try{l(n.throw(o))}catch(p){d(p)}},l=o=>o.done?m(o.value):Promise.resolve(o.value).then(r,a);l((n=n.apply(e,t)).next())});const a="workflow-delay",l=[{value:1e3,label:`{{t('Seconds', { ns: "workflow" })}}`},{value:6e4,label:`{{t('Minutes', { ns: "workflow" })}}`},{value:36e5,label:`{{t('Hours', { ns: "workflow" })}}`},{value:864e5,label:`{{t('Days', { ns: "workflow" })}}`},{value:6048e5,label:`{{t('Weeks', { ns: "workflow" })}}`}];function o(u){return l.slice().reverse().find(c=>!(u%c.value))}function p({value:u=6e4,onChange:c}){const b=t.useCompile(),f=o(u),y=Math.round(u/f.value);return n.jsxs("fieldset",{className:t.css`
        display: flex;
        gap: 0.5em;
      `,children:[n.jsx(d.InputNumber,{min:1,value:y,onChange:i=>c(Math.round(i*f.value)),className:"auto-width"}),n.jsx(d.Select,{role:"button","data-testid":"select-time-unit",popupMatchSelectWidth:!1,value:f.value,onChange:i=>c(Math.round(y*i)),className:"auto-width",options:l.map(i=>({value:i.value,label:b(i.label)}))})]})}class x extends r.Instruction{constructor(){super(...arguments);s(this,"title",`{{t("Delay", { ns: "${a}" })}}`);s(this,"type","delay");s(this,"group","control");s(this,"description",`{{t("Delay a period of time and then continue or exit the process. Can be used to set wait or timeout times in parallel branches.", { ns: "${a}" })}}`);s(this,"icon",n.jsx(m.HourglassOutlined,{}));s(this,"fieldset",{duration:{type:"number",title:`{{t("Duration", { ns: "${a}" })}}`,"x-decorator":"FormItem","x-component":"Duration",default:6e4,required:!0},endStatus:{type:"number",title:`{{t("End status", { ns: "${a}" })}}`,"x-decorator":"FormItem","x-component":"Radio.Group",enum:[{label:`{{t("Succeed and continue", { ns: "${a}" })}}`,value:r.JOB_STATUS.RESOLVED},{label:`{{t("Fail and exit", { ns: "${a}" })}}`,value:r.JOB_STATUS.FAILED}],required:!0,default:r.JOB_STATUS.RESOLVED}});s(this,"components",{Duration:p})}isAvailable({engine:b,workflow:f,upstream:y,branchIndex:i}){return!b.isWorkflowSync(f)}}class v extends t.Plugin{afterAdd(){return w(this,null,function*(){})}beforeLoad(){return w(this,null,function*(){})}load(){return w(this,null,function*(){this.app.pm.get("workflow").registerInstruction("delay",x)})}}e.default=v,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
