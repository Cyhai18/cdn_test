(function(e,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("@nocobase/client"),require("@nocobase/plugin-auth/client"),require("react/jsx-runtime"),require("@ant-design/icons"),require("antd"),require("react"),require("react-i18next"),require("react-router-dom"),require("@formily/react"),require("@nocobase/sdk")):typeof define=="function"&&define.amd?define(["exports","@nocobase/client","@nocobase/plugin-auth/client","react/jsx-runtime","@ant-design/icons","antd","react","react-i18next","react-router-dom","@formily/react","@nocobase/sdk"],t):(e=typeof globalThis!="undefined"?globalThis:e||self,t(e["@nocobase/plugin-saml"]={},e["@nocobase/client"],e["@nocobase/plugin-auth"],e.jsxRuntime,e["@ant-design/icons"],e.antd,e.react,e["react-i18next"],e["react-router-dom"],e["@formily/react"],e["@nocobase/sdk"]))})(this,function(e,t,u,o,d,a,x,m,n,l,v){"use strict";var I=(e,t,u)=>new Promise((o,d)=>{var a=n=>{try{m(u.next(n))}catch(l){d(l)}},x=n=>{try{m(u.throw(n))}catch(l){d(l)}},m=n=>n.done?o(n.value):Promise.resolve(n.value).then(a,x);m((u=u.apply(e,t)).next())});const A="SAML",q="saml";function C(r){return t.i18n.t(r,{ns:q})}function g(){return m.useTranslation(q)}const F=({authenticator:r})=>{const{t:f}=g(),p=t.useAPIClient(),y=n.useLocation(),i=new URLSearchParams(y.search),b=i.get("redirect"),S=()=>I(this,null,function*(){var h;const s=yield p.request({method:"post",url:"saml:getAuthUrl",headers:{"X-Authenticator":r.name},data:{redirect:b}}),c=(h=s==null?void 0:s.data)==null?void 0:h.data;window.location.replace(c)});return x.useEffect(()=>{const s=i.get("authenticator"),c=i.get("error");if(s===r.name&&c){a.message.error(c);return}}),o.jsx(a.Space,{direction:"vertical",className:t.css`
        display: flex;
      `,children:o.jsx(a.Button,{shape:"round",block:!0,icon:o.jsx(d.LoginOutlined,{}),onClick:S,children:f(r.title)})})},P={type:"object",properties:{saml:{type:"object",properties:{ssoUrl:{title:'{{t("SSO URL")}}',"x-component":"Input","x-decorator":"FormItem",required:!0},certificate:{title:'{{t("Public Certificate")}}',"x-component":"Input.TextArea","x-decorator":"FormItem",required:!0},idpIssuer:{title:"idP Issuer","x-component":"Input","x-decorator":"FormItem"},http:{title:'{{t("http")}}',"x-component":"Checkbox","x-decorator":"FormItem"},userBindField:{type:"string",title:'{{t("Use this field to bind the user")}}',"x-component":"Select","x-decorator":"FormItem",default:"email",enum:[{label:C("Email"),value:"email"},{label:C("Username"),value:"username"}],required:!0}}},public:{type:"object",properties:{autoSignup:{"x-decorator":"FormItem",type:"boolean",title:'{{t("Sign up automatically when the user does not exist")}}',"x-component":"Checkbox",default:!0}}},usage:{type:"void","x-component":"Usage"}}},j=l.observer(()=>{var h;const r=l.useForm(),f=t.useRecord(),{t:p}=g(),y=v.getSubAppName()||"main",i=(h=r.values.name)!=null?h:f.name,{protocol:b,host:S}=window.location,s=`${b}//${S}/api/saml:redirect?authenticator=${i}&__appName=${y}`,c=T=>{navigator.clipboard.writeText(T),a.message.success(p("Copied"))};return o.jsxs(a.Card,{title:p("Usage"),type:"inner",children:[o.jsx(t.FormItem,{label:p("SP Issuer/EntityID"),children:o.jsx(t.Input,{value:i,disabled:!0,addonBefore:o.jsx(d.CopyOutlined,{onClick:()=>c(i)})})}),o.jsx(t.FormItem,{label:p("ACS URL"),children:o.jsx(t.Input,{value:s,disabled:!0,addonBefore:o.jsx(d.CopyOutlined,{onClick:()=>c(s)})})})]})},{displayName:"Usage"}),k=()=>{const{t:r}=g();return o.jsx(t.SchemaComponent,{scope:{t:r},components:{Usage:j},schema:P})};class U extends t.Plugin{load(){return I(this,null,function*(){this.app.pm.get(u).registerType(A,{components:{SignInButton:F,AdminSettingsForm:k}})})}}e.SamlPlugin=U,e.default=U,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
