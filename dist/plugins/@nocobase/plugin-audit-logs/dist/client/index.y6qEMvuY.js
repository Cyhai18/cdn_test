(function(a,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("@nocobase/client"),require("react/jsx-runtime"),require("@ant-design/icons"),require("react-i18next"),require("@nocobase/utils/client"),require("@formily/react"),require("@formily/antd-v5"),require("react")):typeof define=="function"&&define.amd?define(["exports","@nocobase/client","react/jsx-runtime","@ant-design/icons","react-i18next","@nocobase/utils/client","@formily/react","@formily/antd-v5","react"],e):(a=typeof globalThis!="undefined"?globalThis:a||self,e(a["@nocobase/plugin-audit-logs"]={},a["@nocobase/client"],a.jsxRuntime,a["@ant-design/icons"],a["react-i18next"],a["@nocobase/utils"],a["@formily/react"],a["@formily/antd-v5"],a.react))})(this,function(a,e,o,p,g,T,s,C,x){"use strict";var ae=Object.defineProperty,le=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var E=(a,e,o)=>e in a?ae(a,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[e]=o,d=(a,e)=>{for(var o in e||(e={}))q.call(e,o)&&E(a,o,e[o]);if(I)for(var o of I(e))O.call(e,o)&&E(a,o,e[o]);return a},u=(a,e)=>le(a,se(e));var M=(a,e)=>{var o={};for(var p in a)q.call(a,p)&&e.indexOf(p)<0&&(o[p]=a[p]);if(a!=null&&I)for(var p of I(a))e.indexOf(p)<0&&O.call(a,p)&&(o[p]=a[p]);return o};var K=(a,e,o)=>new Promise((p,g)=>{var T=x=>{try{C(o.next(x))}catch(v){g(v)}},s=x=>{try{C(o.throw(x))}catch(v){g(v)}},C=x=>x.done?p(x.value):Promise.resolve(x.value).then(T,s);C((o=o.apply(a,e)).next())});function v(){return{type:"void","x-decorator":"AuditLogsBlockProvider","x-acl-action":"auditLogs:list","x-decorator-props":{collection:"auditLogs",action:"list",params:{pageSize:20},rowKey:"id",showIndex:!0,dragSort:!1,disableTemplate:!0},"x-toolbar":"BlockSchemaToolbar","x-settings":"blockSettings:table","x-component":"CardItem","x-filter-targets":[],properties:{actions:{type:"void","x-initializer":"auditLogsTable:configureActions","x-component":"ActionBar","x-component-props":{style:{marginBottom:"var(--nb-spacing)"}},properties:{}},[T.uid()]:{type:"array","x-initializer":"auditLogsTable:configureColumns","x-component":"TableV2","x-use-component-props":"useTableBlockProps","x-component-props":{rowKey:"id",rowSelection:{type:"checkbox"}},properties:{actions:{type:"void",title:'{{ t("Actions") }}',"x-action-column":"actions","x-decorator":"TableV2.Column.ActionBar","x-component":"TableV2.Column","x-designer":"TableV2.ActionColumnDesigner","x-initializer":"auditLogsTable:configureItemActions",properties:{[T.uid()]:{type:"void","x-decorator":"DndContext","x-component":"Space","x-component-props":{split:"|"}}}}}}}}}const L=()=>{const{insert:t}=e.useSchemaInitializer(),{t:i}=g.useTranslation(),r=e.useSchemaInitializerItem(),n=v();return o.jsx(e.SchemaInitializerItem,d({icon:o.jsx(p.TableOutlined,{}),onClick:()=>{t(n)},title:i("Audit Logs")},r))},U=()=>({name:"auditLogs",title:'{{t("Audit logs")}}',fields:[{name:"createdAt",type:"date",interface:"createdAt",uiSchema:{type:"datetime",title:'{{t("Created at")}}',"x-component":"DatePicker","x-component-props":{showTime:!0,ellipsis:!0},"x-read-pretty":!0}},{name:"type",type:"string",interface:"select",uiSchema:{type:"string",title:'{{t("Action type")}}',"x-component":"Select","x-component-props":{ellipsis:!0},"x-read-pretty":!0,enum:[{label:'{{t("Create record")}}',value:"create",color:"lime"},{label:'{{t("Update record")}}',value:"update",color:"gold"},{label:'{{t("Delete record")}}',value:"destroy",color:"magenta"}]}},{name:"recordId",type:"string",interface:"input",uiSchema:{title:'{{t("Record ID")}}',type:"string","x-component":"Input","x-component-props":{ellipsis:!0}}},{collectionName:"auditLogs",name:"collection",type:"belongsTo",interface:"m2o",target:"collections",targetKey:"name",sourceKey:"id",foreignKey:"collectionName",uiSchema:{type:"object",title:'{{t("Collection")}}',"x-component":"AssociationField","x-component-props":{fieldNames:{value:"name",label:"title"},ellipsis:!0},"x-read-pretty":!0}},{name:"user",collectionName:"auditLogs",type:"belongsTo",interface:"createdBy",targetKey:"id",foreignKey:"createdById",target:"users",uiSchema:{type:"object",title:'{{t("User")}}',"x-component":"AssociationField","x-component-props":{fieldNames:{value:"id",label:"nickname"},ellipsis:!0},"x-read-pretty":!0}},{name:"changes",collectionName:"auditLogs",type:"hasMany",interface:"subTable",target:"auditChanges",foreignKey:"auditLogId",targetKey:"id",uiSchema:{type:"object",title:'{{t("Details of changes", { ns: "audit-logs" })}}'}}]}),_=()=>({name:"auditChanges",title:'{{t("Audit Changes")}}',fields:[{name:"field",type:"json",interface:"input",uiSchema:{title:'{{t("Field")}}',"x-component":"AuditLogsField"}},{type:"json",name:"before",interface:"input",uiSchema:{title:'{{t("Before change")}}',"x-component":"AuditLogsValue"}},{type:"json",name:"after",interface:"input",uiSchema:{title:'{{t("After change")}}',"x-component":"AuditLogsValue"}}]}),W=()=>({name:"collections",title:'{{t("Collections")}}',fields:[{name:"name",type:"string",interface:"input",uiSchema:{title:'{{t("Collection name")}}',type:"string","x-component":"Input","x-component-props":{ellipsis:!0}}},{name:"title",type:"string",interface:"input",uiSchema:{title:'{{t("Collection display name")}}',type:"string","x-component":"Input","x-component-props":{ellipsis:!0}}}]}),R=r=>{var n=r,{children:t}=n,i=M(n,["children"]);const c=_(),l=U(),m=W();return o.jsx(e.ExtendCollectionsProvider,{collections:[l,c,m],children:o.jsx(e.TableBlockProvider,u(d({name:"audit-logs"},i),{children:t}))})},J=s.observer(()=>{var r,n,c,l;const t=s.useField(),i=e.useCompile();return t.value?o.jsx(e.EllipsisWithTooltip,{ellipsis:!0,children:(n=(r=t.value)==null?void 0:r.uiSchema)!=null&&n.title?i((l=(c=t.value)==null?void 0:c.uiSchema)==null?void 0:l.title):t.value.name}):null},{displayName:"AuditLogsField"}),H=s.observer(()=>{var r,n;const t=s.useField(),i=e.useRecord();return(r=i.field)!=null&&r.uiSchema?o.jsx(e.FormProvider,{children:o.jsx(e.SchemaComponent,{schema:u(d({name:i.field.name},(n=i.field)==null?void 0:n.uiSchema),{default:t.value,"x-read-pretty":!0})})}):o.jsx(e.EllipsisWithTooltip,{ellipsis:!0,children:t.value?JSON.stringify(t.value):null})},{displayName:"AuditLogsValue"}),Q=()=>{const t={type:"void",title:'{{ t("View") }}',"x-action":"view","x-toolbar":"ActionSchemaToolbar","x-settings":"actionSettings:view","x-component":"Action","x-component-props":{openMode:"drawer"},properties:{drawer:{type:"void",title:'{{ t("View record") }}',"x-component":"Action.Container","x-component-props":{className:"nb-action-popup"},properties:{tabs:{type:"void","x-component":"Tabs","x-component-props":{},properties:{tab1:{type:"void",title:'{{t("Details")}}',"x-component":"Tabs.TabPane","x-designer":"Tabs.Designer","x-component-props":{},properties:{grid:{type:"void","x-component":"Grid",properties:{"7ypqrxaqysp":{type:"void","x-component":"Grid.Row",properties:{"1fc2l8dwe7m":{type:"void","x-component":"Grid.Col",properties:{"5ley6xifrsb":{type:"void","x-acl-action":"auditLogs:get","x-decorator":"FormBlockProvider","x-decorator-props":{resource:"auditLogs",collection:"auditLogs",readPretty:!0,action:"get",params:{appends:["collection","user","changes"]},useParams:"{{ useParamsFromRecord }}",useSourceId:"{{ useSourceIdFromParentRecord }}"},"x-component":"CardItem",properties:{bv710pbf9w6:{type:"void","x-component":"FormV2","x-use-component-props":"useFormBlockProps","x-read-pretty":!0,properties:{grid:{type:"void","x-component":"Grid",properties:{g4c24abnbd9:{type:"void","x-component":"Grid.Row",properties:{fkt9dj5lu1k:{type:"void","x-component":"Grid.Col",properties:{createdAt:{type:"string","x-component":"CollectionField","x-decorator":"FormItem","x-collection-field":"auditLogs.createdAt","x-component-props":{},"x-read-pretty":!0}}}}},l267bkv423v:{type:"void","x-component":"Grid.Row",properties:{tehaepm5xqy:{type:"void","x-component":"Grid.Col",properties:{type:{type:"string","x-component":"CollectionField","x-decorator":"FormItem","x-collection-field":"auditLogs.type","x-component-props":{},"x-read-pretty":!0}}}}},zhmn2tkzdh2:{type:"void","x-component":"Grid.Row",properties:{yuwyej17i64:{type:"void","x-component":"Grid.Col",properties:{recordId:{type:"string","x-component":"CollectionField","x-decorator":"FormItem","x-collection-field":"auditLogs.recordId","x-component-props":{}}}}}},"6q933ic06mj":{type:"void","x-component":"Grid.Row",properties:{nwtbkqd99zl2:{type:"void","x-component":"Grid.Col",properties:{"collection.title":{type:"string","x-component":"CollectionField","x-decorator":"FormItem","x-collection-field":"auditLogs.collection.title","x-component-props":{}}}},nwtbkqd99zl1:{type:"void","x-component":"Grid.Col",properties:{"collection.name":{type:"string","x-component":"CollectionField","x-decorator":"FormItem","x-collection-field":"auditLogs.collection.name","x-component-props":{}}}}}},xd4kzulndqk:{type:"void","x-component":"Grid.Row",properties:{k3sd72n83zd:{type:"void","x-component":"Grid.Col",properties:{user:{type:"string","x-component":"CollectionField","x-decorator":"FormItem","x-collection-field":"auditLogs.user","x-component-props":{},"x-read-pretty":!0,properties:{viewer:{type:"void",title:'{{ t("View record") }}',"x-component":"RecordPicker.Viewer","x-component-props":{className:"nb-action-popup"},properties:{tabs:{type:"void","x-component":"Tabs","x-component-props":{},"x-initializer":"popup:addTab",properties:{tab1:{type:"void",title:'{{t("Details")}}',"x-component":"Tabs.TabPane","x-designer":"Tabs.Designer","x-component-props":{},properties:{grid:{type:"void","x-component":"Grid","x-initializer":"popup:common:addBlock"}}}}}}}}}}}}},"3lghgclbtcg":{type:"void","x-component":"Grid.Row",properties:{"8l1v1auwlx0":{type:"void","x-component":"Grid.Col",properties:{changes:{type:"void","x-component":"TableField","x-decorator":"FormItem","x-collection-field":"auditLogs.changes","x-component-props":{},properties:{block:{type:"void","x-decorator":"TableFieldProvider","x-acl-action":"auditChanges:list","x-decorator-props":{collection:"auditChanges",association:"auditLogs.changes",resource:"auditLogs.changes",action:"list",params:{paginate:!1},showIndex:!0,dragSort:!1},properties:{actions:{type:"void","x-component":"TableField.ActionBar","x-component-props":{}},changes:{type:"array","x-component":"TableV2","x-use-component-props":"useTableFieldProps","x-component-props":{rowSelection:!1},properties:{"5uvv96u9ict":{type:"void","x-decorator":"TableV2.Column.Decorator","x-component":"TableV2.Column",properties:{field:{"x-collection-field":"auditChanges.field","x-component":"CollectionField","x-read-pretty":!0,"x-component-props":{ellipsis:!0}}}},h7a4tgt11gd:{type:"void","x-decorator":"TableV2.Column.Decorator","x-component":"TableV2.Column",properties:{before:{"x-collection-field":"auditChanges.before","x-component":"CollectionField","x-read-pretty":!0,"x-component-props":{ellipsis:!0}}}},m275z8rglzx:{type:"void","x-decorator":"TableV2.Column.Decorator","x-component":"TableV2.Column",properties:{after:{"x-collection-field":"auditChanges.after","x-component":"CollectionField","x-read-pretty":!0,"x-component-props":{ellipsis:!0}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}};return o.jsx(e.ActionInitializer,{schema:t})},X=()=>{var y,B,N,j;const{name:t,title:i}=e.useCollection_deprecated(),r=s.useField(),n=s.useFieldSchema(),{form:c}=e.useFormBlockContext(),{service:l}=e.useTableBlockContext(),{t:m}=g.useTranslation(),{dn:b}=e.useDesignable();return o.jsxs(e.GeneralSchemaDesigner,{title:i||t,children:[o.jsx(e.SchemaSettingsDataScope,{collectionName:t,defaultFilter:((B=(y=n==null?void 0:n["x-decorator-props"])==null?void 0:y.params)==null?void 0:B.filter)||{},form:c,onSubmit:({filter:f})=>{var A;const h=r.decoratorProps.params||{};h.filter=f,r.decoratorProps.params=h,n["x-decorator-props"].params=h,l.run(u(d({},(A=l.params)==null?void 0:A[0]),{filter:f,page:1})),b.emit("patch",{schema:{"x-uid":n["x-uid"],"x-decorator-props":n["x-decorator-props"]}})}}),o.jsx(e.SchemaSettingsSelectItem,{title:m("Records per page"),value:((j=(N=r.decoratorProps)==null?void 0:N.params)==null?void 0:j.pageSize)||20,options:[{label:"10",value:10},{label:"20",value:20},{label:"50",value:50},{label:"100",value:100},{label:"200",value:200}],onChange:f=>{var A;const h=r.decoratorProps.params||{};h.pageSize=f,r.decoratorProps.params=h,n["x-decorator-props"].params=h,l.run(u(d({},(A=l.params)==null?void 0:A[0]),{pageSize:f,page:1})),b.emit("patch",{schema:{"x-uid":n["x-uid"],"x-decorator-props":n["x-decorator-props"]}})}}),o.jsx(e.SchemaSettingsDivider,{}),o.jsx(e.SchemaSettingsRemove,{removeParentsIfNoChildren:!0,breakRemoveOn:{"x-component":"Grid"}})]})},Y={name:"auditLogs",title:'{{t("Audit logs")}}',fields:[{name:"createdAt",type:"date",interface:"createdAt",uiSchema:{type:"datetime",title:'{{t("Created at")}}',"x-component":"DatePicker","x-component-props":{showTime:!0},"x-read-pretty":!0}},{name:"type",type:"string",interface:"select",uiSchema:{type:"string",title:'{{t("Action type")}}',"x-component":"Select","x-read-pretty":!0,enum:[{label:'{{t("Create record")}}',value:"create",color:"lime"},{label:'{{t("Update record")}}',value:"update",color:"gold"},{label:'{{t("Delete record")}}',value:"destroy",color:"magenta"}]}}]},Z=s.observer(()=>{var i,r;const t=s.useField();return o.jsx("div",{children:((i=t==null?void 0:t.value)==null?void 0:i.nickname)||((r=t.value)==null?void 0:r.id)})},{displayName:"Username"}),$=s.observer(()=>{const t=s.useField(),{title:i,name:r}=t.value||{},n=e.useCompile();return o.jsx("div",{children:i?n(i):r})},{displayName:"Collection"}),ee=s.observer(()=>{var r,n,c,l;const t=s.useField(),i=e.useCompile();return t.value?o.jsx("div",{children:(n=(r=t.value)==null?void 0:r.uiSchema)!=null&&n.title?i((l=(c=t.value)==null?void 0:c.uiSchema)==null?void 0:l.title):t.value.name}):null},{displayName:"Field"}),te=s.observer(()=>{var r,n;const t=s.useField(),i=C.ArrayTable.useRecord();return(r=i.field)!=null&&r.uiSchema?o.jsx(e.FormProvider,{children:o.jsx(e.SchemaComponent,{schema:u(d({name:i.field.name},(n=i.field)==null?void 0:n.uiSchema),{default:t.value,"x-read-pretty":!0})})}):o.jsx("div",{children:t.value?JSON.stringify(t.value):null})},{displayName:"Value"}),S=x.createContext(null);S.displayName="IsAssociationBlock";const F=()=>{const t=x.useContext(S),i={};return t||(i.column31={type:"void","x-component":"TableV2.Column",title:'{{t("Record ID")}}',properties:{recordId:{"x-component":"Input","x-read-pretty":!0}}}),o.jsx(e.SchemaComponent,{memoized:!0,components:{ArrayTable:C.ArrayTable,Username:Z,Collection:$,Field:ee,Value:te},schema:{type:"void",name:"lfm4trkw8j3","x-component":"div",properties:{actions:{type:"void","x-component":"ActionBar","x-component-props":{style:{marginBottom:16}},properties:{filter:{type:"void",title:'{{ t("Filter") }}',"x-action":"filter","x-component":"Filter.Action","x-use-component-props":"useFilterActionProps","x-component-props":{icon:"FilterOutlined"},"x-align":"left"}}},y84dlntcaup:{type:"array","x-component":"TableV2","x-use-component-props":"useTableBlockProps","x-component-props":{rowKey:"id",rowSelection:{type:"checkbox"}},properties:u(d({actions:{type:"void",title:'{{ t("Actions") }}',"x-action-column":"actions","x-decorator":"TableV2.Column.ActionBar","x-component":"TableV2.Column","x-designer":"TableV2.ActionColumnDesigner","x-initializer":"table:configureItemActions",properties:{actions:{type:"void","x-decorator":"DndContext","x-component":"Space","x-component-props":{split:"|"},properties:{o80rypwmeeg:{type:"void",title:'{{ t("View") }}',"x-toolbar":"ActionSchemaToolbar","x-settings":"actionSettings:view","x-component":"Action.Link","x-component-props":{openMode:"drawer"},properties:{drawer:{type:"void",title:'{{ t("View record") }}',"x-component":"Action.Container","x-component-props":{className:"nb-action-popup"},properties:{grid:{type:"void","x-component":"Grid",properties:{tdlav8o9o17:{type:"void","x-component":"Grid.Row",properties:{"7bsnaf47i6g":{type:"void","x-component":"Grid.Col",properties:{"6s2qbihe3tu":{type:"void","x-acl-action":"auditLogs:get","x-decorator":"FormBlockProvider","x-decorator-props":{resource:"auditLogs",collection:"auditLogs",readPretty:!0,action:"get",params:{appends:["collection","user","changes"]},useParams:"{{ useParamsFromRecord }}",useSourceId:"{{ useSourceIdFromParentRecord }}"},"x-component":"CardItem",properties:{mevpuonrda0:{type:"void","x-component":"FormV2","x-use-component-props":"useFormBlockProps","x-read-pretty":!0,properties:{grid:{type:"void","x-component":"Grid",properties:{row1:{type:"void","x-component":"Grid.Row",properties:{col11:{type:"void","x-component":"Grid.Col",properties:{collection:{type:"string",title:'{{t("Collection display name")}}',"x-component":"Collection","x-decorator":"FormItem","x-read-pretty":!0}}}}},row2:{type:"void","x-component":"Grid.Row",properties:{col21:{type:"void","x-component":"Grid.Col",properties:{type:{type:"string","x-component":"CollectionField","x-decorator":"FormItem","x-read-pretty":!0}}}}},row3:{type:"void","x-component":"Grid.Row",properties:{col31:{type:"void","x-component":"Grid.Col",properties:{createdAt:{type:"string","x-component":"CollectionField","x-decorator":"FormItem","x-read-pretty":!0}}}}},row4:{type:"void","x-component":"Grid.Row",properties:{col41:{type:"void","x-component":"Grid.Col",properties:{user:{type:"string",title:'{{t("User")}}',"x-component":"Username","x-decorator":"FormItem","x-read-pretty":!0}}}}},row5:{type:"void","x-component":"Grid.Row",properties:{col51:{type:"void","x-component":"Grid.Col",properties:{changes:{type:"array",title:'{{t("Field value changes")}}',"x-decorator":"FormItem","x-component":"ArrayTable","x-component-props":{pagination:{pageSize:10},scroll:{x:"100%"}},items:{type:"object",properties:{column3:{type:"void","x-component":"ArrayTable.Column","x-component-props":{width:200,title:'{{t("Field")}}'},properties:{field:{type:"string","x-component":"Field"}}},column4:{type:"void","x-component":"ArrayTable.Column","x-component-props":{width:200,title:'{{t("Before change")}}'},properties:{before:{type:"string","x-decorator":"FormItem","x-component":"Value"}}},column5:{type:"void","x-component":"ArrayTable.Column","x-component-props":{width:200,title:'{{t("After change")}}'},properties:{after:{type:"string","x-decorator":"FormItem","x-component":"Value"}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},column1:{type:"void","x-decorator":"TableV2.Column.Decorator","x-component":"TableV2.Column",properties:{createdAt:{"x-component":"CollectionField","x-read-pretty":!0}}},column2:{type:"void","x-decorator":"TableV2.Column.Decorator","x-component":"TableV2.Column",properties:{type:{"x-component":"CollectionField","x-read-pretty":!0}}},column3:{type:"void","x-component":"TableV2.Column",title:'{{t("Collection display name")}}',properties:{collection:{"x-component":"Collection","x-read-pretty":!0}}}},i),{column4:{type:"void","x-component":"TableV2.Column",title:'{{t("User")}}',properties:{user:{"x-component":"Username","x-read-pretty":!0}}}})}}}})};F.Decorator=s.observer(t=>{var l;const i=e.useCollection_deprecated(),r=e.useRecord();let n=(l=t==null?void 0:t.params)==null?void 0:l.filter;if(i.name){const m=r==null?void 0:r[i.filterTargetKey||"id"];n?n={$and:[n,{collectionName:i.name,recordId:`${m}`}]}:n={collectionName:i.name,recordId:`${m}`}}const c={collection:"auditLogs",resource:"auditLogs",action:"list",params:u(d({pageSize:20,appends:["collection","user"]},t.params),{filter:n,sort:"-createdAt"}),rowKey:"id",showIndex:!0,dragSort:!1};return o.jsx(S.Provider,{value:!!i.name,children:o.jsx(e.ExtendCollectionsProvider,{collections:[Y],children:o.jsx(e.TableBlockProvider,u(d({},c),{children:t.children}))})})},{displayName:"AuditLogs.Decorator"}),F.Designer=X;const oe=()=>{const t={type:"void",title:'{{ t("Actions") }}',"x-decorator":"TableV2.Column.ActionBar","x-component":"TableV2.Column","x-designer":"TableV2.ActionColumnDesigner","x-initializer":"auditLogsTable:configureItemActions","x-action-column":"actions",properties:{actions:{type:"void","x-decorator":"DndContext","x-component":"Space","x-component-props":{split:"|"},properties:{}}}},i=e.useSchemaInitializerItem();return o.jsx(e.InitializerWithSwitch,u(d({},i),{schema:t,item:i,type:"x-action-column"}))},w=t=>o.jsx(e.SchemaComponentOptions,{components:{AuditLogs:F,AuditLogsBlockProvider:R,AuditLogsBlockInitializer:L,AuditLogsValue:H,AuditLogsField:J,AuditLogsViewActionInitializer:Q,AuditLogsTableActionColumnInitializer:oe},children:t.children}),z=new e.CompatibleSchemaInitializer({name:"AuditLogsTableActionColumnInitializers",insertPosition:"beforeEnd",Component:t=>o.jsx(p.MenuOutlined,u(d({},t),{style:{cursor:"pointer"}})),useInsert(){const t=s.useFieldSchema(),i=e.useAPIClient(),{refresh:r}=e.useDesignable(),{t:n}=g.useTranslation();return c=>{const l=t.reduceProperties((b,y)=>y["x-component"]==="Space"?y:b,null);if(!l)return;const m=e.createDesignable({t:n,api:i,refresh:r,current:l});m.loadAPIClientEvents(),m.insertBeforeEnd(c)}},items:[{name:"enableActions",type:"itemGroup",title:'{{t("Enable actions")}}',children:[{name:"view",type:"item",title:'{{t("View")}}',Component:"AuditLogsViewActionInitializer",schema:{"x-component":"Action.Link","x-action":"view","x-decorator":"ACLActionProvider"}}]},{name:"divider",type:"divider"},{name:"columnWidth",type:"item",title:'{{t("Column width")}}',Component:e.Resizable}]}),ie=new e.CompatibleSchemaInitializer({name:"auditLogsTable:configureItemActions",insertPosition:"beforeEnd",Component:t=>o.jsx(p.MenuOutlined,u(d({},t),{style:{cursor:"pointer"}})),useInsert(){const t=s.useFieldSchema(),i=e.useAPIClient(),{refresh:r}=e.useDesignable(),{t:n}=g.useTranslation();return c=>{const l=t.reduceProperties((b,y)=>y["x-component"]==="Space"?y:b,null);if(!l)return;const m=e.createDesignable({t:n,api:i,refresh:r,current:l});m.loadAPIClientEvents(),m.insertBeforeEnd(c)}},items:[{name:"enableActions",type:"itemGroup",title:'{{t("Enable actions")}}',children:[{name:"view",type:"item",title:'{{t("View")}}',Component:"AuditLogsViewActionInitializer",schema:{"x-component":"Action.Link","x-action":"view","x-decorator":"ACLActionProvider"}}]},{name:"divider",type:"divider"},{name:"columnWidth",type:"item",title:'{{t("Column width")}}',Component:e.Resizable}]},z),P=new e.CompatibleSchemaInitializer({name:"AuditLogsTableActionInitializers",title:"{{t('Configure actions')}}",icon:"SettingOutlined",style:{marginLeft:8},items:[{type:"itemGroup",title:"{{t('Enable actions')}}",name:"enableActions",children:[{name:"filter",title:"{{t('Filter')}}",Component:"FilterActionInitializer",schema:{"x-align":"left"}},{name:"refresh",title:"{{t('Refresh')}}",Component:"RefreshActionInitializer",schema:{"x-align":"right"}}]}]}),ne=new e.CompatibleSchemaInitializer({name:"auditLogsTable:configureActions",title:"{{t('Configure actions')}}",icon:"SettingOutlined",style:{marginLeft:8},items:[{type:"itemGroup",title:"{{t('Enable actions')}}",name:"enableActions",children:[{name:"filter",title:"{{t('Filter')}}",Component:"FilterActionInitializer",schema:{"x-align":"left"}},{name:"refresh",title:"{{t('Refresh')}}",Component:"RefreshActionInitializer",schema:{"x-align":"right"}}]}]},P),k=()=>{const t=e.useInheritsTableColumnInitializerFields(),{t:i}=g.useTranslation(),r=e.useCompile();if(!(t!=null&&t.length))return null;const n=[];return t.forEach(c=>{Object.values(c)[0].length&&n.push({type:"itemGroup",divider:!0,title:i("Parent collection fields")+"("+r(`${Object.keys(c)[0]}`)+")",children:Object.values(c)[0]})}),o.jsx(e.SchemaInitializerChildren,{children:n})},V=()=>{const t=e.useAssociatedTableColumnInitializerFields(),{t:i}=g.useTranslation();if(!(t!=null&&t.length))return null;const r=[{type:"itemGroup",divider:!0,title:i("Display association fields"),children:t}];return o.jsx(e.SchemaInitializerChildren,{children:r})},G=new e.CompatibleSchemaInitializer({name:"AuditLogsTableColumnInitializers",insertPosition:"beforeEnd",icon:"SettingOutlined",title:'{{t("Configure columns")}}',wrap(t){return t["x-action-column"]?t:{type:"void","x-decorator":"TableV2.Column.Decorator","x-designer":"TableV2.Column.Designer","x-component":"TableV2.Column",properties:{[t.name]:d({},t)}}},items:[{name:"displayFields",type:"itemGroup",title:'{{t("Display fields")}}',useChildren:e.useTableColumnInitializerFields},{name:"parentCollectionFields",Component:k},{name:"associationFields",Component:V},{name:"actionColumn",title:'{{t("Action column")}}',Component:"AuditLogsTableActionColumnInitializer"}]}),re=new e.CompatibleSchemaInitializer({name:"auditLogsTable:configureColumns",insertPosition:"beforeEnd",icon:"SettingOutlined",title:'{{t("Configure columns")}}',wrap(t){return t["x-action-column"]?t:{type:"void","x-decorator":"TableV2.Column.Decorator","x-designer":"TableV2.Column.Designer","x-component":"TableV2.Column",properties:{[t.name]:d({},t)}}},items:[{name:"displayFields",type:"itemGroup",title:'{{t("Display fields")}}',useChildren:e.useTableColumnInitializerFields},{name:"parentCollectionFields",Component:k},{name:"associationFields",Component:V},{name:"actionColumn",title:'{{t("Action column")}}',Component:"AuditLogsTableActionColumnInitializer"}]},G);class D extends e.Plugin{load(){return K(this,null,function*(){this.app.use(w),this.app.schemaInitializerManager.add(P),this.app.schemaInitializerManager.add(ne),this.app.schemaInitializerManager.add(z),this.app.schemaInitializerManager.add(ie),this.app.schemaInitializerManager.add(G),this.app.schemaInitializerManager.add(re);const i=this.app.schemaInitializerManager.get("page:addBlock"),r=this.app.schemaInitializerManager.get("popup:common:addBlock"),n={title:'{{t("Audit logs")}}',Component:"AuditLogsBlockInitializer"};i.add("otherBlocks.auditLogs",n),r.add("otherBlocks.auditLogs",n)})}}a.AuditLogsBlockInitializer=L,a.AuditLogsProvider=w,a.PluginAuditLogsClient=D,a.default=D,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
