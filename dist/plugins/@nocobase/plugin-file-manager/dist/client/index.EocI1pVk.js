(function(r,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("@nocobase/client"),require("react/jsx-runtime"),require("antd"),require("react"),require("react-i18next"),require("@ant-design/icons"),require("@formily/shared"),require("lodash"),require("@formily/antd-v5"),require("@formily/react")):typeof define=="function"&&define.amd?define(["exports","@nocobase/client","react/jsx-runtime","antd","react","react-i18next","@ant-design/icons","@formily/shared","lodash","@formily/antd-v5","@formily/react"],t):(r=typeof globalThis!="undefined"?globalThis:r||self,t(r["@nocobase/plugin-file-manager"]={},r["@nocobase/client"],r.jsxRuntime,r.antd,r.react,r["react-i18next"],r["@ant-design/icons"],r["@formily/shared"],r.lodash,r["@formily/antd-v5"],r["@formily/react"]))})(this,function(r,t,o,h,d,b,v,u,y,$,S){"use strict";var X=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var P=(r,t,o)=>t in r?X(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o,x=(r,t)=>{for(var o in t||(t={}))oe.call(t,o)&&P(r,o,t[o]);if(_)for(var o of _(t))ne.call(t,o)&&P(r,o,t[o]);return r},I=(r,t)=>ee(r,te(t));var a=(r,t,o)=>(P(r,typeof t!="symbol"?t+"":t,o),o);var K=(r,t,o)=>new Promise((h,d)=>{var b=y=>{try{u(o.next(y))}catch($){d($)}},v=y=>{try{u(o.throw(y))}catch($){d($)}},u=y=>y.done?h(y.value):Promise.resolve(y.value).then(b,v);u((o=o.apply(r,t)).next())});const e="file-manager";function U(){return b.useTranslation(e)}const E=1024*1024*1024,k=Object.freeze(Object.defineProperty({__proto__:null,FILE_LIMIT_SIZE:E,useUploadFiles:()=>{const{service:s}=t.useBlockRequestContext(),{t:p}=U(),{setVisible:n}=t.useActionContext(),{props:i}=t.useBlockRequestContext(),c=t.useCollection(),m=t.useSourceIdFromParentRecord(),C=d.useMemo(()=>{let F=`${c.name}:create`;if(i!=null&&i.association){const[f,q]=i.association.split(".");F=`${f}/${m}/${q}:create`}return F},[c.name,i==null?void 0:i.association,m]),{setSelectedRows:g}=d.useContext(t.RecordPickerContext)||{},l={};let A=0;return{action:C,beforeUpload(F){return F.size>E?(h.notification.error({message:`${p("File size cannot exceed")} ${E/1024/1024}M`}),F.status="error",!1):!0},onChange(F){F.forEach(f=>{var q;f.status==="uploading"&&!l[f.uid]&&(A++,l[f.uid]=!0),f.status!=="uploading"&&l[f.uid]&&(delete l[f.uid],--A===0&&((q=s==null?void 0:s.refresh)==null||q.call(s),g==null||g(Q=>[...Q,...F.filter(D=>D.status==="done").map(D=>D.response.data)])))}),F.every(f=>f.status==="done")&&n(!1)}}}},Symbol.toStringTag,{value:"Module"})),O=s=>{t.useCollection_deprecated();const p={type:"void","x-action":"create",title:"{{t('Upload')}}","x-designer":"Action.Designer","x-component":"Action","x-decorator":"ACLActionProvider","x-component-props":{openMode:"drawer",type:"primary",icon:"UploadOutlined"},properties:{drawer:{type:"void",title:'{{ t("Upload files") }}',"x-component":"Action.Container",properties:{upload:{type:"void",title:'{{ t("Upload files") }}',"x-component":"Upload.DraggerV2","x-use-component-props":"useUploadFiles","x-component-props":{height:"50vh",multiple:!0,listType:"picture"}}}}}};return o.jsx(t.ActionInitializer,I(x({},s),{schema:p}))},M=s=>o.jsx(t.SchemaComponentOptions,{scope:k,components:{UploadActionInitializer:O},children:s.children}),R={local:{properties:{documentRoot:{title:`{{t("Destination", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",default:"storage/uploads"}}},"ali-oss":{properties:{region:{title:`{{t("Region", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},accessKeyId:{title:`{{t("AccessKey ID", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},accessKeySecret:{title:`{{t("AccessKey Secret", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Password",required:!0},bucket:{title:`{{t("Bucket", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},thumbnailRule:{title:"Thumbnail rule",type:"string","x-decorator":"FormItem","x-component":"Input"}}},"tx-cos":{properties:{Region:{title:`{{t("Region", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},SecretId:{title:`{{t("SecretId", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},SecretKey:{title:`{{t("SecretKey", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Password",required:!0},Bucket:{title:`{{t("Bucket", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0}}},s3:{properties:{region:{title:`{{t("Region", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},accessKeyId:{title:`{{t("AccessKey ID", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},secretAccessKey:{title:`{{t("AccessKey Secret", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Password",required:!0},bucket:{title:`{{t("Bucket", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},endpoint:{title:`{{t("Endpoint", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input"}}}},L=S.observer(s=>{const p=S.useForm(),n=S.useField(),[i,c]=d.useState(new S.Schema({}));return d.useEffect(()=>{c(new S.Schema(R[p.values.type]||{}))},[p.values.type]),o.jsx($.FormLayout,{layout:"vertical",children:o.jsx(S.RecursionField,{basePath:n.address,onlyRenderProperties:!0,schema:i},p.values.type||"local")})},{displayName:"StorageOptions"}),w={name:"storages",fields:[{type:"integer",name:"title",interface:"input",uiSchema:{title:'{{t("Title")}}',type:"string","x-component":"Input",required:!0}},{type:"string",name:"name",interface:"input",uiSchema:{title:`{{t("Storage name", { ns: "${e}" })}}`,descriptions:`{{t("Will be used for API", { ns: "${e}" })}}`,type:"string","x-component":"Input"}},{type:"string",name:"type",interface:"select",uiSchema:{title:`{{t("Storage type", { ns: "${e}" })}}`,type:"string","x-component":"Select",required:!0,enum:"{{ storageTypes }}"}},{type:"string",name:"baseUrl",interface:"input",uiSchema:{title:`{{t("Storage base URL", { ns: "${e}" })}}`,type:"string","x-component":"Input",required:!0}},{type:"string",name:"path",interface:"input",uiSchema:{title:`{{t("Path", { ns: "${e}" })}}`,type:"string","x-component":"Input"}},{type:"boolean",name:"default",interface:"boolean",uiSchema:{type:"boolean","x-component":"Checkbox"}},{type:"boolean",name:"paranoid",interface:"boolean",uiSchema:{type:"boolean","x-component":"Checkbox"}}]},B={type:"object",properties:{[u.uid()]:{type:"void","x-decorator":"ResourceActionProvider","x-decorator-props":{collection:w,resourceName:"storages",request:{resource:"storages",action:"list",params:{pageSize:50,sort:["id"],appends:[]}}},"x-component":"CollectionProvider_deprecated","x-component-props":{collection:w},properties:{actions:{type:"void","x-component":"ActionBar","x-component-props":{style:{marginBottom:16}},properties:{delete:{type:"void",title:'{{ t("Delete") }}',"x-component":"Action","x-component-props":{icon:"DeleteOutlined",useAction:"{{ cm.useBulkDestroyAction }}",confirm:{title:"{{t('Delete')}}",content:"{{t('Are you sure you want to delete it?')}}"}}},create:{type:"void",title:'{{t("Add new")}}',"x-component":"CreateStorage","x-component-props":{type:"primary"}}}},table:{type:"void","x-uid":"input","x-component":"Table.Void","x-component-props":{rowKey:"id",rowSelection:{type:"checkbox"},useDataSource:"{{ cm.useDataSourceFromRAC }}"},properties:{title:{type:"void","x-decorator":"Table.Column.Decorator","x-component":"Table.Column",properties:{title:{type:"number","x-component":"CollectionField","x-read-pretty":!0}}},name:{type:"void","x-decorator":"Table.Column.Decorator","x-component":"Table.Column",properties:{name:{type:"string","x-component":"CollectionField","x-read-pretty":!0}}},default:{type:"void","x-decorator":"Table.Column.Decorator","x-component":"Table.Column",title:`{{t("Default storage", { ns: "${e}" })}}`,properties:{default:{type:"string","x-component":"CollectionField","x-read-pretty":!0}}},actions:{type:"void",title:'{{t("Actions")}}',"x-component":"Table.Column",properties:{actions:{type:"void","x-component":"Space","x-component-props":{split:"|"},properties:{update:{type:"void",title:'{{t("Edit")}}',"x-component":"EditStorage","x-component-props":{type:"primary"}},delete:{type:"void",title:'{{ t("Delete") }}',"x-component":"Action.Link","x-component-props":{confirm:{title:'{{t("Delete")}}',content:'{{t("Are you sure you want to delete it?")}}'},useAction:"{{cm.useDestroyAction}}"}}}}}}}}}}}},j=()=>{const[s,p]=d.useState({}),n=t.usePlugin(T),i=t.useCompile(),[c,m]=d.useState(!1),{t:C}=b.useTranslation();return o.jsx("div",{children:o.jsxs(t.ActionContext.Provider,{value:{visible:c,setVisible:m},children:[o.jsx(h.Dropdown,{menu:{onClick(g){const l=n.storageTypes.get(g.key);m(!0),p({type:"object",properties:{[u.uid()]:{type:"void","x-component":"Action.Drawer","x-decorator":"Form","x-decorator-props":{initialValue:{type:l.name}},title:i("{{t('Add new')}}")+" - "+i(l.title),properties:I(x({},y.cloneDeep(l.properties)),{footer:{type:"void","x-component":"Action.Drawer.Footer",properties:{cancel:{title:'{{t("Cancel")}}',"x-component":"Action","x-component-props":{useAction:"{{ cm.useCancelAction }}"}},submit:{title:'{{t("Submit")}}',"x-component":"Action","x-component-props":{type:"primary",useAction:"{{ cm.useCreateAction }}"}}}}})}}})},items:[...n.storageTypes.values()].map(g=>({key:g.name,label:i(g.title)}))},children:o.jsxs(h.Button,{type:"primary",icon:o.jsx(v.PlusOutlined,{}),children:[C("Add new")," ",o.jsx(v.DownOutlined,{})]})}),o.jsx(t.SchemaComponent,{scope:{createOnly:!0},schema:s})]})})},z=()=>{const s=t.useRecord(),[p,n]=d.useState({}),i=t.usePlugin(T),c=t.useCompile(),[m,C]=d.useState(!1),{t:g}=b.useTranslation();return o.jsx("div",{children:o.jsxs(t.ActionContext.Provider,{value:{visible:m,setVisible:C},children:[o.jsx("a",{onClick:()=>{C(!0);const l=i.storageTypes.get(s.type);l.properties.default&&(l.properties.default["x-reactions"]=A=>{A.initialValue?A.disabled=!0:A.disabled=!1}),n({type:"object",properties:{[u.uid()]:{type:"void","x-component":"Action.Drawer","x-decorator":"Form","x-decorator-props":{initialValue:x({},s)},title:c("{{t('Edit')}}")+" - "+c(l.title),properties:I(x({},y.cloneDeep(l.properties)),{footer:{type:"void","x-component":"Action.Drawer.Footer",properties:{cancel:{title:'{{t("Cancel")}}',"x-component":"Action","x-component-props":{useAction:"{{ cm.useCancelAction }}"}},submit:{title:'{{t("Submit")}}',"x-component":"Action","x-component-props":{type:"primary",useAction:"{{ cm.useUpdateAction }}"}}}}})}}})},children:g("Edit")}),o.jsx(t.SchemaComponent,{scope:{createOnly:!1},schema:p})]})})},N=()=>{const{t:s}=b.useTranslation(),p=t.useCompile(),i=[...t.usePlugin(T).storageTypes.values()].map(m=>({value:m.name,label:p(m.title)})),c=o.jsxs("div",{children:[s("See more")," ",o.jsx("a",{target:"_blank",href:"https://help.aliyun.com/zh/oss/user-guide/resize-images-4",rel:"noreferrer",children:"x-oss-process"})]});return o.jsx(h.Card,{bordered:!1,children:o.jsx(t.SchemaComponent,{components:{StorageOptions:L,CreateStorage:j,EditStorage:z},scope:{useNewId:m=>`${m}${u.uid()}`,storageTypes:i,xStyleProcessDesc:c},schema:B})})},V={title:`{{t("Aliyun OSS", { ns: "${e}" })}}`,name:"ali-oss",properties:{title:{"x-component":"CollectionField","x-decorator":"FormItem"},name:{"x-component":"CollectionField","x-decorator":"FormItem","x-disabled":"{{ !createOnly }}",required:!0,default:'{{ useNewId("s_") }}',description:'{{t("Randomly generated and can be modified. Support letters, numbers and underscores, must start with an letter.")}}'},baseUrl:{"x-component":"CollectionField","x-decorator":"FormItem"},options:{type:"object","x-component":"div",properties:{region:{title:`{{t("Region", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},accessKeyId:{title:`{{t("AccessKey ID", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},accessKeySecret:{title:`{{t("AccessKey Secret", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Password",required:!0},bucket:{title:`{{t("Bucket", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},thumbnailRule:{title:"Thumbnail rule",type:"string","x-decorator":"FormItem","x-component":"Input","x-component-props":{placeholder:"?x-oss-process=image/auto-orient,1/resize,m_fill,w_94,h_94/quality,q_90"},default:"?x-oss-process=image/auto-orient,1/resize,m_fill,w_94,h_94/quality,q_90",description:"{{ xStyleProcessDesc }}"}}},path:{"x-component":"CollectionField","x-decorator":"FormItem"},default:{"x-component":"CollectionField","x-decorator":"FormItem","x-content":`{{t("Default storage", { ns: "${e}" })}}`},paranoid:{"x-component":"CollectionField","x-decorator":"FormItem","x-content":`{{t("Keep file in storage when destroy record", { ns: "${e}" })}}`}}},Y={title:`{{t("Local storage", { ns: "${e}" })}}`,name:"local",properties:{title:{"x-component":"CollectionField","x-decorator":"FormItem"},name:{"x-component":"CollectionField","x-decorator":"FormItem","x-disabled":"{{ !createOnly }}",required:!0,default:'{{ useNewId("s_") }}',description:'{{t("Randomly generated and can be modified. Support letters, numbers and underscores, must start with an letter.")}}'},baseUrl:{"x-component":"CollectionField","x-decorator":"FormItem","x-hidden":!0,default:"/storage/uploads"},options:{type:"object","x-component":"div",properties:{documentRoot:{title:`{{t("Destination", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input","x-display":"hidden",default:"storage/uploads"}}},path:{"x-component":"CollectionField","x-decorator":"FormItem","x-component-props":{addonBefore:"storage/uploads/"}},default:{"x-component":"CollectionField","x-decorator":"FormItem","x-content":`{{t("Default storage", { ns: "${e}" })}}`},paranoid:{"x-component":"CollectionField","x-decorator":"FormItem","x-content":`{{t("Keep file in storage when destroy record", { ns: "${e}" })}}`}}},W={title:`{{t("Amazon S3", { ns: "${e}" })}}`,name:"s3",properties:{title:{"x-component":"CollectionField","x-decorator":"FormItem"},name:{"x-component":"CollectionField","x-decorator":"FormItem","x-disabled":"{{ !createOnly }}",required:!0,default:'{{ useNewId("s_") }}',description:'{{t("Randomly generated and can be modified. Support letters, numbers and underscores, must start with an letter.")}}'},baseUrl:{"x-component":"CollectionField","x-decorator":"FormItem"},options:{type:"object","x-component":"div",properties:{region:{title:`{{t("Region", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},accessKeyId:{title:`{{t("AccessKey ID", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},secretAccessKey:{title:`{{t("AccessKey Secret", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Password",required:!0},bucket:{title:`{{t("Bucket", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},endpoint:{title:`{{t("Endpoint", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input"}}},path:{"x-component":"CollectionField","x-decorator":"FormItem"},default:{"x-component":"CollectionField","x-decorator":"FormItem","x-content":`{{t("Default storage", { ns: "${e}" })}}`},paranoid:{"x-component":"CollectionField","x-decorator":"FormItem","x-content":`{{t("Keep file in storage when destroy record", { ns: "${e}" })}}`}}},Z={title:`{{t("Tencent COS", { ns: "${e}" })}}`,name:"tx-cos",properties:{title:{"x-component":"CollectionField","x-decorator":"FormItem"},name:{"x-component":"CollectionField","x-decorator":"FormItem","x-disabled":"{{ !createOnly }}",required:!0,default:'{{ useNewId("s_") }}',description:'{{t("Randomly generated and can be modified. Support letters, numbers and underscores, must start with an letter.")}}'},baseUrl:{"x-component":"CollectionField","x-decorator":"FormItem"},options:{type:"object","x-component":"div",properties:{Region:{title:`{{t("Region", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},SecretId:{title:`{{t("SecretId", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0},SecretKey:{title:`{{t("SecretKey", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Password",required:!0},Bucket:{title:`{{t("Bucket", { ns: "${e}" })}}`,type:"string","x-decorator":"FormItem","x-component":"Input",required:!0}}},path:{"x-component":"CollectionField","x-decorator":"FormItem"},default:{"x-component":"CollectionField","x-decorator":"FormItem","x-content":`{{t("Default storage", { ns: "${e}" })}}`},paranoid:{"x-component":"CollectionField","x-decorator":"FormItem","x-content":`{{t("Keep file in storage when destroy record", { ns: "${e}" })}}`}}},G={local:Y,"ali-oss":V,s3:W,"tx-cos":Z};class H extends t.CollectionFieldInterface{constructor(){super(...arguments);a(this,"name","attachment");a(this,"type","object");a(this,"group","media");a(this,"title",`{{t("Attachment", { ns: "${e}" })}}`);a(this,"isAssociation",!0);a(this,"default",{type:"belongsToMany",target:"attachments",uiSchema:{type:"array","x-component":"Upload.Attachment","x-component-props":{}}});a(this,"availableTypes",["belongsToMany"]);a(this,"properties",I(x({},t.interfacesProperties.defaultProps),{"uiSchema.x-component-props.accept":{type:"string",title:`{{t("MIME type", { ns: "${e}" })}}`,"x-component":"Input","x-decorator":"FormItem",description:"Set the file types selectable by the file selector. Example: image/png",default:"image/*"},"uiSchema.x-component-props.flutterFileSource":{type:"array",title:`{{t("File upload methods on mobile", { ns: "${e}" })}}`,required:!0,"x-component":"Select","x-component-props":{multiple:!0},"x-decorator":"FormItem",enum:[{label:"Choose from Album",value:t.FLUTTER_FILE_SOURCE_TYPE.ALBUM},{label:"Take photo or video",value:t.FLUTTER_FILE_SOURCE_TYPE.CAMERA},{label:"File selector",value:t.FLUTTER_FILE_SOURCE_TYPE.FILE_SELECTOR},{label:"Document scanner",value:t.FLUTTER_FILE_SOURCE_TYPE.DOCUMENT_SCANNER}],description:"Determine the available methods for mobile file uploads based on the options.",default:t.DEFAULT_FLUTTER_FILE_SOURCE_TYPES},"uiSchema.x-component-props.multiple":{type:"boolean","x-content":`{{t('Allow uploading multiple files', { ns: "${e}" })}}`,"x-decorator":"FormItem","x-component":"Checkbox",default:!0,"x-reactions":{target:"uiSchema.x-component-props.maxCount",fulfill:{state:{hidden:"{{!$self.value}}"}}}},"uiSchema.x-component-props.maxCount":{type:"number",title:`{{t('Maximum number of files', { ns: "${e}" })}}`,"x-decorator":"FormItem","x-component":"InputNumber","x-component-props":{min:2}},storage:{type:"string",title:`{{t("Storage", { ns: "${e}" })}}`,description:`{{t('Default storage will be used when not selected', { ns: "${e}" })}}`,"x-decorator":"FormItem","x-component":"Select","x-reactions":["{{useAsyncDataSourceWithCallback(loadStorages, { sucCallback: setDefaultStorageByAssociatedApp  })}}"]}}));a(this,"filterable",{children:[{name:"id",title:'{{t("Exists")}}',operators:[{label:'{{t("exists")}}',value:"$exists",noValue:!0},{label:'{{t("not exists")}}',value:"$notExists",noValue:!0}],schema:{title:'{{t("Exists")}}',type:"string","x-component":"Input"}},{name:"filename",title:`{{t("Filename", { ns: "${e}" })}}`,operators:t.interfacesProperties.operators.string,schema:{title:`{{t("Filename", { ns: "${e}" })}}`,type:"string","x-component":"Input"}}]})}schemaInitialize(n,{block:i,field:c}){["Table","Kanban"].includes(i)&&(n["x-component-props"]=n["x-component-props"]||{},n["x-component-props"].size="small"),n["x-component-props"]||(n["x-component-props"]={}),n["x-component-props"].action=`${c.target}:create${c.storage?`?attachmentField=${c.collectionName}.${c.name}`:""}`,n["x-component-props"].uploadAreaConfig={icon:"plusoutlined",text:`{{t("Click or drag file to this area to upload", { ns: "${e}" })}}`,hint:`{{t("Supports single or bulk upload and multiple file formats.", { ns: "${e}" })}}`}}initialize(n){n.through||(n.through=`t_${u.uid()}`),n.foreignKey||(n.foreignKey=`f_${u.uid()}`),n.otherKey||(n.otherKey=`f_${u.uid()}`),n.sourceKey||(n.sourceKey="id"),n.targetKey||(n.targetKey="id")}}class J extends t.CollectionTemplate{constructor(){super(...arguments);a(this,"name","file");a(this,"title",`{{t("File collection", { ns: "${e}" })}}`);a(this,"order",3);a(this,"color","blue");a(this,"default",{createdBy:!0,updatedBy:!0,fields:[{interface:"input",type:"string",name:"title",deletable:!1,uiSchema:{type:"string",title:'{{t("Title")}}',"x-component":"Input"}},{interface:"input",type:"string",name:"filename",deletable:!1,uiSchema:{type:"string",title:`{{t("File name", { ns: "${e}" })}}`,"x-component":"Input","x-read-pretty":!0}},{interface:"input",type:"string",name:"extname",deletable:!1,uiSchema:{type:"string",title:`{{t("Extension name", { ns: "${e}" })}}`,"x-component":"Input","x-read-pretty":!0}},{interface:"integer",type:"integer",name:"size",deletable:!1,uiSchema:{type:"number",title:`{{t("Size", { ns: "${e}" })}}`,"x-component":"InputNumber","x-read-pretty":!0,"x-component-props":{stringMode:!0,step:"0"}}},{interface:"input",type:"string",name:"mimetype",deletable:!1,uiSchema:{type:"string",title:`{{t("MIME type", { ns: "${e}" })}}`,"x-component":"Input","x-read-pretty":!0}},{interface:"input",type:"string",name:"path",deletable:!1,uiSchema:{type:"string",title:`{{t("Path", { ns: "${e}" })}}`,"x-component":"Input","x-read-pretty":!0}},{interface:"input",type:"string",name:"url",deletable:!1,uiSchema:{type:"string",title:'{{t("URL")}}',"x-component":"Input.URL","x-read-pretty":!0}},{interface:"url",type:"string",name:"preview",field:"url",deletable:!1,uiSchema:{type:"string",title:`{{t("Preview", { ns: "${e}" })}}`,"x-component":"Preview","x-read-pretty":!0}},{comment:"存储引擎",type:"belongsTo",name:"storage",target:"storages",foreignKey:"storageId",deletable:!1,uiSchema:{type:"string",title:`{{t("Storage", { ns: "${e}" })}}`,"x-component":"Input","x-read-pretty":!0}},{type:"jsonb",name:"meta",deletable:!1,defaultValue:{}}]});a(this,"presetFieldsDisabled",!0);a(this,"configurableProperties",x(I(x(I(x(x({},t.getConfigurableProperties("associatedApp")),t.getConfigurableProperties("title","name")),{inherits:I(x({},t.getConfigurableProperties("inherits").inherits),{"x-reactions":["{{useAsyncDataSource(loadCollections)}}"]})}),t.getConfigurableProperties("category","description")),{storage:{title:`{{t("File storage", { ns: "${e}" })}}`,type:"hasOne",name:"storage","x-decorator":"FormItem","x-component":"Select","x-reactions":["{{useAsyncDataSourceWithCallback(loadStorages, { sucCallback: setDefaultStorageByAssociatedApp  })}}"]}}),t.getConfigurableProperties("presetFields")))}}class T extends t.Plugin{constructor(){super(...arguments);a(this,"storageTypes",new Map)}load(){return K(this,null,function*(){this.app.dataSourceManager.addFieldInterfaces([H]),this.app.dataSourceManager.addCollectionTemplates([J]),this.app.use(M),this.app.pluginSettingsManager.add(e,{title:`{{t("File manager", { ns: "${e}" })}}`,icon:"FileOutlined",Component:N,aclSnippet:"pm.file-manager.storages"}),Object.values(G).forEach(i=>{this.registerStorageType(i.name,i)});const n=this.app.schemaInitializerManager.get("table:configureActions");n==null||n.add("enableActions.upload",{title:"{{t('Upload')}}",Component:"UploadActionInitializer",schema:{"x-align":"right","x-decorator":"ACLActionProvider","x-acl-action-props":{skipScopeCheck:!0}},useVisible(){return t.useCollection_deprecated().template==="file"}})})}registerStorageType(n,i){this.storageTypes.set(n,i)}}r.PluginFileManagerClient=T,r.default=T,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
