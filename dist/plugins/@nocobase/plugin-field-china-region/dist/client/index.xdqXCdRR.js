(function(e,n){typeof exports=="object"&&typeof module!="undefined"?n(exports,require("@nocobase/client"),require("@formily/react"),require("@nocobase/utils/client")):typeof define=="function"&&define.amd?define(["exports","@nocobase/client","@formily/react","@nocobase/utils/client"],n):(e=typeof globalThis!="undefined"?globalThis:e||self,n(e["@nocobase/plugin-field-china-region"]={},e["@nocobase/client"],e["@formily/react"],e["@nocobase/utils"]))})(this,function(e,n,i,d){"use strict";var x=Object.defineProperty,y=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var v=(e,n,i)=>n in e?x(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i,C=(e,n)=>{for(var i in n||(n={}))P.call(n,i)&&v(e,i,n[i]);if(m)for(var i of m(n))R.call(n,i)&&v(e,i,n[i]);return e},S=(e,n)=>y(e,L(n));var b=(e,n,i)=>new Promise((d,r)=>{var h=o=>{try{s(i.next(o))}catch(c){r(c)}},f=o=>{try{s(i.throw(o))}catch(c){r(c)}},s=o=>o.done?d(o.value):Promise.resolve(o.value).then(h,f);s((i=i.apply(e,n)).next())});const r=s=>{const c=i.useField().componentProps.maxLevel;return n.useRequest({resource:"chinaRegions",action:"list",params:{sort:"code",paginate:!1,filter:{level:1}}},S(C({},s),{onSuccess(t){var l;s==null||s.onSuccess({data:((l=t==null?void 0:t.data)==null?void 0:l.map(a=>(c!==1&&(a.isLeaf=!1),a)))||[]})},manual:!0}))},h=()=>{const s=n.useAPIClient(),o=i.useField(),c=o.componentProps.maxLevel;return t=>{var a;const l=t[t.length-1];((a=l==null?void 0:l.children)==null?void 0:a.length)>0||(l.loading=!0,s.resource("chinaRegions").list({sort:"code",paginate:!1,filter:{parentCode:l.code}}).then(({data:u})=>{var g;l.loading=!1,l.children=((g=u==null?void 0:u.data)==null?void 0:g.map(p=>(c>p.level&&(p.isLeaf=!1),p)))||[],o.dataSource=[...o.dataSource]}).catch(u=>{d.captureException(u)}))}};class f extends n.Plugin{load(){return b(this,null,function*(){this.app.addScopes({useChinaRegionDataSource:r,useChinaRegionLoadData:h})})}}e.PluginFieldChinaRegionClient=f,e.default=f,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
